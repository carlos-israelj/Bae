<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bae - Monitor de Beb√©</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: system-ui, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container { max-width: 800px; margin: 0 auto; }
        .card {
            background: white;
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        h1 {
            color: white;
            margin-bottom: 20px;
            text-align: center;
        }
        .status { display: flex; justify-content: space-between; gap: 20px; }
        .metric { flex: 1; text-align: center; }
        .metric-value {
            font-size: 48px;
            font-weight: bold;
            color: #667eea;
        }
        .metric-label { color: #666; margin-top: 8px; }
        .alert {
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 12px;
        }
        .alert-warning {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
        }
        .alert-critical {
            background: #f8d7da;
            border-left: 4px solid #dc3545;
        }
        .timestamp {
            color: #999;
            font-size: 14px;
            text-align: center;
            margin-top: 16px;
        }
        .loading { text-align: center; padding: 40px; color: #666; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üçº Monitor de Beb√© Bae</h1>
        
        <div class="card">
            <h2>Estado Actual</h2>
            <div id="current-status" class="loading">Cargando datos...</div>
        </div>

        <div class="card">
            <h2>Alertas Recientes</h2>
            <div id="alerts" class="loading">Cargando alertas...</div>
        </div>
    </div>

    <script>
        const API_URL = 'https://bae-api-server.onrender.com';
        const DEVICE_ID = 'ESP32-001';

        async function fetchLatestReading() {
            try {
                const response = await fetch(`${API_URL}/api/v1/sensors/${DEVICE_ID}/latest`);
                const data = await response.json();
                
                if (data.success && data.data) {
                    displayCurrentStatus(data.data);
                }
            } catch (error) {
                document.getElementById('current-status').innerHTML = 
                    '‚ùå Error: ' + error.message;
            }
        }

        async function fetchAlerts() {
            try {
                const response = await fetch(`${API_URL}/api/v1/sensors/${DEVICE_ID}/alerts?limit=5`);
                const data = await response.json();
                
                if (data.success && data.data) {
                    displayAlerts(data.data);
                }
            } catch (error) {
                document.getElementById('alerts').innerHTML = 
                    '‚ùå Error: ' + error.message;
            }
        }

        function displayCurrentStatus(reading) {
            const temp = reading.temperature.toFixed(1);
            const humidity = reading.humidity.toFixed(1);
            const date = new Date(reading.timestamp * 1000);

            document.getElementById('current-status').innerHTML = `
                <div class="status">
                    <div class="metric">
                        <div class="metric-value">${temp}¬∞C</div>
                        <div class="metric-label">Temperatura</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value">${humidity}%</div>
                        <div class="metric-label">Humedad</div>
                    </div>
                </div>
                <div class="timestamp">
                    ${date.toLocaleString()}
                </div>
            `;
        }

        function displayAlerts(alerts) {
            if (alerts.length === 0) {
                document.getElementById('alerts').innerHTML = 
                    '<p class="loading">No hay alertas üéâ</p>';
                return;
            }

            const html = alerts.map(alert => {
                const icon = alert.severity === 'critical' ? 'üö®' : '‚ö†Ô∏è';
                const date = new Date(alert.timestamp * 1000);
                
                return `
                    <div class="alert alert-${alert.severity}">
                        ${icon} <strong>${alert.alert_type}:</strong> ${alert.message}
                        <div style="font-size: 12px; color: #666; margin-top: 4px;">
                            ${date.toLocaleString()}
                        </div>
                    </div>
                `;
            }).join('');

            document.getElementById('alerts').innerHTML = html;
        }

        // Cargar datos iniciales
        fetchLatestReading();
        fetchAlerts();

        // Actualizar cada 30 segundos
        setInterval(fetchLatestReading, 30000);
        setInterval(fetchAlerts, 60000);
    </script>
</body>
</html>